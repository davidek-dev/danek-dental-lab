---
import { contentfulClient } from "../lib/contentful";
import type { BlogPost } from "../lib/contentful";
import { documentToHtmlString } from "@contentful/rich-text-html-renderer";

const entries = await contentfulClient.getEntries<BlogPost>({
  content_type: "blogPost",
});

const posts = entries.items.map((item) => {
  const { title, date, description, slug } = item.fields;
  return {
    title,
    slug,
    description,
    date: new Date(date).toLocaleDateString(),
  };
});
---


<h1 class="text-5xl mt-5 mb-8 border-b-2">My Blog</h1>
<ul>
  {
    posts.map((post) => (
      <li class="mb-8">
        <a href={`/posts/${post.slug}/`}>
          <h2 class="text-2xl">{post.title}</h2>
        </a>
        <time>{post.date}</time>
        <br />
        <article set:html={documentToHtmlString(post.description)} />
      </li>
    ))
  }
</ul>